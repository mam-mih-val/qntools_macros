//
// Created by Misha on 3/7/2023.
//

#cmakedefine QNTOOLS_BASE_PATH "@QNTOOLS_BASE_PATH@"
#cmakedefine QNTOOLS_CORR_PATH "@QNTOOLS_CORR_PATH@"
#cmakedefine QNTOOLS_INCLUDE_PATH "@QNTOOLS_INCLUDE_PATH@"
#cmakedefine Eigen_INCLUDE_PATH "@Eigen_INCLUDE_PATH@"
#cmakedefine THIS_SRC_PATH "@THIS_SRC_PATH@"

#include <TROOT.h>
#include <stdexcept>
#include <TSystem.h>
#include <TSystem.h>

int main(int n_args, char** args){
  if( n_args < 2 )
    throw std::runtime_error( "No argumets provided" );

  gInterpreter->AddIncludePath(QNTOOLS_INCLUDE_PATH);
  gInterpreter->AddIncludePath(Eigen_INCLUDE_PATH);
  gInterpreter->Load(QNTOOLS_BASE_PATH);
  gInterpreter->Load(QNTOOLS_CORR_PATH);
  
  gInterpreter->AddIncludePath(THIS_SRC_PATH);
  
  std::string macro{args[1]};
  std::string macro_full = macro+"(";
  for( int i=2; i<n_args; ++i ){
    macro_full+="\""+ std::string{args[i]}+"\",";
  }
  macro_full.back()=')';
  gInterpreter->ExecuteMacro(macro_full.c_str());
  return 0;
}